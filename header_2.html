<html>
<head>
	<script type="text/javascript" src="bower_components/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="bower_components/handlebars/handlebars.min.js"></script>
	<script type="text/javascript" src="bower_components/moment/min/moment.min.js"></script>
	
	<script type="text/javascript" src="js/helpers.js"></script>
	<script type="text/javascript" src="js/gimme.js"></script>
	
	<link href="bower_components/sassquatch/css/sassquatch.css" type="text/css" rel="stylesheet" />
	<link href="css/whitney.css" type="text/css" rel="stylesheet" /> <!-- whitney will get bowerized -->
	<link href="css/patch.css" type="text/css" rel="stylesheet" />
	<link href="css/home.css" type="text/css" rel="stylesheet" />
	
	<link rel="stylesheet" type="text/css" href="css/calendario.css" />
	<script type="text/javascript" src="components/Calendario/js/jquery.calendario.js"></script>
	
	<link rel="stylesheet" type="text/css" href="components/ElegantIcons/style.css" />

</head>
<body>


<script type="text/html" id="main-template">
<!-- pages -->
<div class="page off inverted" id="page-members">
	<div class="page-header">
		
		<div class="fixflex">
			<div class="flex big">
				&nbsp;
			</div>
			<div class="fix">
				<div id="page-members-close" class="clickable nobreak"><span class="arrow_carrot-down_alt2"></span> Done</div>
			</div>
		</div>
		
	</div>
	<div class="page-body" style="display: flex;  align-items: center; justify-content: center;">
		<ul class="inlineList hscroll" style="vertical-align: top;">
			{{#members}}
			<li class="align-center" style="display: inline-block; width: 280px; vertical-align: top;">
				<div style="padding: 24px;">
					<div class="avatar-160 clickable" style="background-image: url({{photo}})"></div>
					<h3 class="clickable">{{name}}</h3>
					<p class="less">Joined {{dateFormat joined}}</p>
					<p>{{#bio}}&ldquo;{{.}}&rdquo;{{/bio}}</p>
				</div>
			{{/members}}
		</ul>
	</div>
</div>

<div class="page off inverted" id="page-calendar">
<div class="calendar-wrapper" id="calendar">
	<div class="page-header">
		<div class="fixflex">
			<div class="flex big">
				<strong  class="custom-month"></strong>
				<span  class="custom-year"></span>
				<span  class="custom-prev clickable arrow_carrot-left"></span>
				<span  class="custom-next clickable arrow_carrot-right"></span>
			</div>
			<div class="fix">
				<div id="page-calendar-close" class="clickable nobreak"><span class="arrow_carrot-down_alt2"></span> Done</div>
			</div>
		</div>
	</div>
	<div class="page-body">
		<div class="fc-calendar-container"></div>
	</div>
</div>
</div>


<!-- screen start -->
<div class="doc-stripe bg-gray {{#if opts.member}}groupinfo-collapsed{{/if}}" id="groupstuff">
	<!-- header -->
	
		<div id="groupheader" style="position: relative">
			<div class="line linear-at-medium" style="position: absolute; height: 100%; left: -5% ; width: 110%;">
				<div class="unit hide-at-medium" style="width: 12.5%;">
					<div class="photo50" style="background-image: url({{group.photos.[2].photo_link}})" />
					<div class="photo50" style="background-image: url({{group.photos.[3].photo_link}})" />
				</div>
				<div class="unit hide-at-medium" style="width: 12.5%;">
					<div class="photo50" style="background-image: url({{group.photos.[0].photo_link}})" />
					<div class="photo50" style="background-image: url({{group.photos.[1].photo_link}})" />
				</div>
				<div class="unit size1of2">
					<div class="photo100" style="background-image: url({{banner}})" />
				</div>
				<div class="unit hide-at-medium" style="width: 12.5%;">
					<div class="photo50" style="background-image: url({{group.photos.[3].photo_link}})" />
					<div class="photo50" style="background-image: url({{group.photos.[2].photo_link}})" />
				</div>
				<div class="unit hide-at-medium" style="width: 12.5%;">
					<div class="photo50" style="background-image: url({{group.photos.[1].photo_link}})" />
					<div class="photo50" style="background-image: url({{group.photos.[0].photo_link}})" />
				</div>
			</div>
			<div class="nametag-photo inverted" style="background: transparent; height: 100%">
				
				<div class="nametag-photo-name">
					<div id="groupheader-icon" style="background-image: url(http://www.sfoac.com/www/htdocs/OAC_LOGO_CLR_SM.gif)"></div>
					<h1 class="padding-none">{{group.name}}</h1>
					<p class="muted">{{numberFormat group.members}} {{group.who}} &middot; {{group.city}}, {{group.state}}</p>
				</div>
			</div>
		</div>

					<!--
					<div id="groupheader-icon"></div>
					<h2 class="margin-none padding-none">{{group.name}}</h2>
					<p class="margin-minimal meta">
						{{group.city}}, {{group.state}} &middot; {{numberFormat group.members}} {{group.who}}
						<span class="collapse-related" id="show-groupinfo">&middot; more info</span>
					</p>
					{{#if opts.member}}
						<div class="tag clickable">
							MEMBER
							<span class="arrow_carrot-down"></span>
						</div>
					{{else}}
						<input class="button primary" value="Join us!" />
					{{/if}}
					-->
				
	
	<div id="" >
		<div class="doc-bounds">
			<div class="line-gutters wide linear-at-medium" style="margin-top: -6px;">
				<div class="unit size2of3 hide-at-medium">
						<ul class="tabs big" style="font-weight: bold;">
							<li class="selected">Home</li>
							<li>Photos</li>
							<li>Discussion</li>
							<li>Contribute</li>
							<li>More</li>
						</ul>
				</div>
				<div class="unit size1of3 align-right center-at-medium" >
					<div class="center-at-handheld">
						
						{{#if opts.trial}}
							<div class="inline-block align-right" style="vertical-align: middle; margin-right: 12px; margin-bottom: 12px;">
								<div style="width: 120px; height: 4px; background: #ccc; display: inline-block; margin-bottom: 4px;">
									<div style="width: 70%; background: green; height: 100%;"></div>
								</div><br />
								<span class="small">3 days left in your trial</small>
							</div>
						{{/if}}
						
						{{#if opts.member}}
							<div class="inline-block pill" style="margin-top: -7px; margin-bottom: 12px;" >Member</div>
						{{else}}
							<a href="" class="big button primary block-at-handheld" style="margin-top: -11px; min-width: 130px;">Join us</a>
						{{/if}}
					</div>
				</div>				
			</div>
			
			<div style="border-top: 1px solid #ddd; padding-top: 18px;">
				<div class="grid-test">
					<div class="unit-test size5of7">
						<div>{{{truncate group.description 500}}}</div>
			
						<!-- zoom into member browser view  (clicking on org also does this??) -->
						<div style="border-top: 1px solid #ddd; padding-top: 18px;">
						<h4 class="margin-minimal">We're {{numberFormat group.members}} {{group.who}} <span class="muted">&middot; 2 friends</span></h4>
						<div id="member-mask" class="mask">
							<ul class="inlineList" id="members" data-count="{{group.members}}">
								{{#members}}
								<li>
									<div class="avatar avatar-60 margin-none clickable" style="background-image: url({{photo}})"></div>
								{{/members}}
				
								<!-- backfill with enough dummy circles to fill out rows -->
								{{#times 28}}
									<li>
										<div class="avatar avatar-60 margin-none" style="background-color: rgba(0,0,0,.05)"></div>
								{{/times}}
							</ul>
						</div>
						</div>
					
					</div>
					<div class="unit-test size2of7 small center-at-handheld">
							<!--
							{{#group.organizer}}
								<div class="figureset">
									<div class="figureset-figure">
										<!-- API does not give org photo -- >
										<div class="avatar avatar-60 clickable" style="background-image: url('http://api.randomuser.me/0.3/portraits/women/1.jpg'); margin-top: -6px; margin-bottom: 0;"></div>
									</div>
									<div class="figureset-description">
										Organized by:
										<h5>{{name}}</h5>
									</div>
								</div>
							{{/group.organizer}}
							-->
							
							<div class="">		
								<h5>Membership dues</h5>
								<p>$5.00/month <a href="">Learn more</a>
							</div>
							<div class="hide-at-handheld">
								<h5>Founded</h5>
								<p>
								{{dateFormat group.created}}</p>
							</div>
							<div class="hide-at-handheld">
								<h5>Past meetups</h5>
								<p>
								108</p>
							</div>
							<div class="hide-at-handheld">
								<h5>Avg. meetup size</h5>
								<p>
								23 people</p>
							</div>
	
							<div class="hide-at-handheld">
								<h5>About how often?</h5>
								<p>
								3x a month</p>
							</div>
						
				
					</div>
				</div>
			</div>
			
			
			
			<!-- collapsable group info -->
			<!-- group data collapses into swipeable stuff at small sizes -->
			<!-- members are swipeable -->
		</div>
	</div>
</div>

<div class="doc-stripe"><div class="doc-bounds align-center">	

<div style="height: 500px;">

</div></div>


<!--
<div class="doc-stripe"><div class="doc-bounds">	
	<div class="line-gutters wide linear-at-medium">
		<div class="unit size2of3">
		
		<div id="talk-bar">
			<ul class="inlineList margin-minimal clickable big">
				<li class="margin-right selected" style="font-weight: bold;">
					<span class="icon_comment_alt"></span>
					Write post
				</li>
				<li class="margin-right">
					<span class="icon_camera_alt"></span>
					Add photo
				</li>
				<li class="margin-right">
					<span class="icon_piechart"></span>
					Poll
				</li>
			</ul>
			<textarea></textarea>
		</div>
		
			<ul class="dividedList">
			{{#discussions}}
				{{#if started_by.name}}
				<li>
				<div class="figureset">
					<div class="figureset-figure">
						<div class="avatar avatar-60 margin-none clickable" style="background-image: url('{{started_by.photo}}')"></div>
					</div>
					<div class="figureset-description">
						<h4>{{started_by.name}}</h4>
						<p class="margin-minimal">{{truncate body 400}}</p>
						<p class="small">
							{{#if likes}}
								<strong>{{likes}} likes</strong> &middot; 
							{{/if}}
							<a href="">Like</a> &middot; 
							<a href="">Comment</a> &middot; 
							<span class="less">{{dateRelative created}}</span>
						</p>							
						
						{{#if replies}}	
							<div class="replies">
								{{#replies}}
								<div class="figureset">
										<div class="figureset-figure">
											<div class="avatar avatar-40 margin-none clickable" style="background-image: url('{{photo}}')"></div>
										</div>
										<div class="figureset-description">
											<h4>{{name}}</h4>
											<p class="margin-minimal">{{body}}</p>
											<p class="small">
												{{#if likes}}
													<strong>{{likes}} likes</strong> &middot; 
												{{/if}}
												<a href="">Like</a> &middot; 
												<a href="">Comment</a> &middot; 
												<span class="less">{{dateRelative ../created}}</span>
											</p>
										</div>
									</div>
								{{/replies}}
							</div>
						{{/if}}
					</div>
				</div>
				</li>
				{{/if}}
			{{/discussions}}
			</ul>
		</div>
	
		<div class="unit size1of3">
			
			<div class="calendar-wrapper calendar-mini hide-at-medium" id="mini-calendar">
				<div class="custom-header fixflex">
					<div class="flex big">
						
						<span  class="custom-month"></span>
						<span  class="custom-year"></span>
						<span  class="custom-prev clickable arrow_carrot-left"></span>
						<span  class="custom-next clickable arrow_carrot-right"></span>
						
					</div>
					<div class="fix">
						<span id="show-calendar" class="clickable"><span class="arrow_expand avatar-30" style="background: #fff; margin: -5px -5px 0 0; text-align: center; line-height: 30px;"></span></span>
					</div>
				</div>
				<div class="fc-calendar-container"></div>
			</div>
			
			
			<ul class="dividedList">
			{{#events}}
				<li>
				<div class="figureset">
					<div class="figureset-figure">
						<div class="tinycal">
							<div class="month"></div> 
							<div class="day">{{dateFormat time format="D"}}</div>
						</div> 
					</div>
					<div class="figureset-description" style="padding-left: 9px;">
						<p class="margin-none">{{dateFormat time format="dddd, MMM D [at] h:mma"}}</p>
						<h4 class="margin-minimal">{{name}}</h4>
						<p class="small">{{numberFormat yes_rsvp_count}} {{group.who}} going</p> 
					</div>
				</div>
				</li>
			{{/events}}
			</ul>
		</div>
	</div>
</div></div>
-->

<div class="doc-stripe bg-gray"><div class="doc-bounds">	
	<h3 class="margin-minimal">Members of this group are also in</h3>
	<ul class="blockList has5" style="overflow-y: auto; white-space: nowrap;">
			{{#groups}}
			<li style="min-width: 200px;">
				<div class="doc-box clickable">
					<div class="nametag-photo" style="background-image: url({{photo}})"><div class="nametag-photo-name">
						<div class="doc-content inverted">
							<h4 class="margin-minimal padding-none" style="white-space: normal;">{{name}}</h4>
						</div>
					</div></div>
				</div>
			<!-- no </li> tag to avoid whitespace -->
			{{/groups}}
		</ul>
</div></div>

<!--
{{#if group.sponsors}}
<div class="doc-stripe bg-gray"><div class="doc-bounds">	
	<h3 class="margin-minimal">{{group.name}} is sponsored by</h3>
	<ul class="blockList has5" >
			{{#group.sponsors}}
				<li>
				<h4 class="margin-minimal padding-none">{{name}}</h4>
				{{info}}
				
			{{/group.sponsors}}
		</ul>
</div></div>
{{/if}}
-->

</script>




<script type="text/javascript">
$(function(){	
	/* 
	* Uncomment the data you want -- it will be available in the template 
	* Check out the Meetup API docs for a list of fields to use in the template
	* http://www.meetup.com/meetup_api/docs/
	*
	* A few notes:
	* -- You can specify any field supported by the API
	* -- You can leave every field unspecified except "gimme" -- something random/fun will be picked for you.
	*/
	
	/* Add your own pre-rendering JS here */
	function getHashParams() {
		var hashParams = {};
		var e, a = /\+/g,
			// Regex for replacing addition symbol with a space
			r = /([^&;=]+)=?([^&;]*)/g,
			d = function(s) {
				return decodeURIComponent(s.replace(a, " "));
			},
			q = window.location.hash.substring(1);

		while (e = r.exec(q))
		hashParams[d(e[1])] = d(e[2]);

		return hashParams;
	}
	var opts = getHashParams();
	var demo = opts.group || 0;
	
	/*
	var shoppingList = [
		{"gimme": "groups", "page": 5},		
		{"gimme": "group"},
		//{"gimme": "open_events"}, 
		//{"gimme": "dates_with_open_events"}, 
		{"gimme": "events", "page": 15}, 
		//{"gimme": "event"},		
		//{"gimme": "rsvps"},	
		//{"gimme": "event_comments"},
		//{"gimme": "photo_albums"},
		//{"gimme": "photos"},
		{"gimme": "members", "page": 40},
		//{"gimme": "profile"},
		//{"gimme": "categories"},
		{"gimme": "discussions", "page": 9}
	];
	*/
	
	var demos = [
		{
			extraContext: {
				banner: "http://photos4.meetupstatic.com/photos/event/e/1/f/c/highres_323457852.jpeg"
			},
			shoppingList: [
					{"gimme": "groups", "page": 5},		
					{"gimme": "group", "group_id": 1227102},
					{"gimme": "events", "page": 15, "group_id": 1227102},
					{"gimme": "members", "page": 40, "group_id": 1227102},
					//{"gimme": "discussions", "page": 9, "urlkey": "shutterbugexcursions", "board_id": 854675}
				]
		},
		{
			extraContext: {
				banner: "http://photos2.meetupstatic.com/photos/event/6/c/f/4/highres_282927892.jpeg"
			},
			shoppingList: [
					{"gimme": "groups", "page": 5},		
					{"gimme": "group", "group_id": 1052584},
					{"gimme": "events", "page": 15, "group_id": 1052584},
					{"gimme": "members", "page": 40, "group_id": 1052584},
					//{"gimme": "discussions", "page": 9, "urlkey": "adventurers-237", "board_id": 884899}
				]
		},
		{
			extraContext: {
				banner: "http://photos1.meetupstatic.com/photos/event/d/e/0/0/highres_317996832.jpeg"
			},
			shoppingList: [
					{"gimme": "groups", "page": 5},		
					{"gimme": "group", "group_id": 5163882},
					{"gimme": "events", "page": 15, "group_id": 5163882},
					{"gimme": "members", "page": 40, "group_id": 5163882},
					//{"gimme": "discussions", "page": 9, "urlkey": "7-Languages-in-7-Months-NYC", "board_id": 6413112}
			]
		},
		{
			extraContext: {
				banner: "http://photos4.meetupstatic.com/photos/event/c/c/4/4/highres_324112292.jpeg"
			},
			shoppingList: [
					{"gimme": "groups", "page": 5},		
					{"gimme": "group", "group_id": 1618009},
					{"gimme": "events", "page": 15, "group_id": 1618009},
					{"gimme": "members", "page": 40, "group_id": 1618009},
					//{"gimme": "discussions", "page": 9, "urlkey": "Stroller-Strides-of-Midtown-Raleigh", "board_id": 1278016}
			]
		}
	
	];
	var shoppingList = demos[demo].shoppingList;
	var extraContext = $.extend( demos[demo].extraContext, {"opts": opts} ); // anything else to add to the handlebars context?
	
	// Let's go!
	var gme = new Gimme(shoppingList, function(){
		$("#template-holder").load('./js/partials.html', function(){ // load partials
			$('body').append( Handlebars.compile( $('#main-template').html() )( gme.context ) ); // render template
			defaultRenderCompleteActions(); // do standard jquery magicks
			
			/* Add your own post-rendering JS here */
			// 
			$('#show-groupinfo').click(function(){
				$('#groupstuff').removeClass('groupinfo-collapsed');
			});
			
			
			// -------------- MEMBERS ---------------
			$('#members,#org').click(function(){
				$('#page-members').removeClass('off');
			});
			$('#page-members-close').click(function(){
				$('#page-members').addClass('off');
			});

			function overflow_members(){
				var $last_visible;
				var mask_height = $('#member-mask').height();
				var remaining_members = $('#members').data('count');
				$('#members .avatar').each(function(){
					var $this = $(this);
					if($this.position().top > mask_height){
						$('#members .avatar').removeClass('count');
						$last_visible.addClass('count').html("<div class='count_number'>+"+remaining_members+" more</div>");
						return false; // break
					}
					else{
						$last_visible = $this;
						remaining_members--;
					}
				});
			}
			overflow_members();
			$(window).resize(overflow_members);

			
			// -------------- CALENDAR ---------------
			// parse events into calendario-style data
			// TODO support multiple events per day
			var cal_events = {};
			
			for(var i = 0; i < gme.context.events.length; i++){
				var ev = gme.context.events[i];
				var ev_date = moment( ev.time ).format("MM-DD-YYYY");
				cal_events[ev_date] = "<div>"+ev.name+"</div>";
			}
			
			// render full calendario
			function setup_calendar($el, opts){
				var $cal = $el.find(".fc-calendar-container:first");
				var cal = $cal.calendario( opts );
				var $month = $el.find( '.custom-month' ).html( cal.getMonthName() );
				var $year = $el.find( '.custom-year' ).html( cal.getYear() );
				$el.find( '.custom-next' ).on( 'click', function() {
					cal.gotoNextMonth( updateMonthYear );
				} );
				$el.find( '.custom-prev' ).on( 'click', function() {
					cal.gotoPreviousMonth( updateMonthYear );
				} );
				function updateMonthYear() {				
					$month.html( cal.getMonthName() );
					$year.html( cal.getYear() );
				}
				return cal;
			}
			
			setup_calendar( $( '#calendar' ),  {
				caldata : cal_events,
				displayWeekAbbr : true
			});
			
		
			setup_calendar( $( '#mini-calendar' ),  {
				caldata : cal_events,
				displayWeekAbbr : true
			});
			


			$('#show-calendar').click(function(){
				$('#page-calendar').removeClass('off');
			});
			$('#page-calendar-close').click(function(){
				$('#page-calendar').addClass('off');
			});
			
			
			// -------------- DISCUSSION ---------------
			
		});
	}, extraContext);
});
</script>

<div id="template-holder"></div>

</body>
</html>
